(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var r in s)t.o(s,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var s=t.n(e);const r=flarum.core.compat["forum/components/Post"];var o=t.n(r);const n=flarum.core.compat["common/extend"],i=flarum.core.compat["forum/states/DiscussionListState"];var c=t.n(i);const a=flarum.core.compat["forum/components/DiscussionListItem"];var p=t.n(a);const u=flarum.core.compat["common/utils/string"],l=flarum.core.compat["tags/models/Tag"];var f=t.n(l);const d=flarum.core.compat["common/Model"];var v=t.n(d);const h=flarum.core.compat["forum/components/SearchPage"];var x=t.n(h);const y=flarum.core.compat["forum/components/SettingsPage"];var g=t.n(y);const b=flarum.core.compat["common/utils/Stream"];var P=t.n(b);s().initializers.add("prippp-synopsis",(function(){(function(){function t(){(0,n.extend)(p().prototype,"infoItems",(function(t){var e,r,o,n,i=this.attrs.discussion;if(!s().session.user||s().session.user.preferences().showSynopsisExcerpts){var c,a=i.tags();a&&(c=a[a.length-1]);var p="first"===s().forum.attribute("synopsis.excerpt_type")?i.firstPost():i.lastPost(),l="number"==typeof(null==(e=c)?void 0:e.excerptLength())?null==(r=c)?void 0:r.excerptLength():s().forum.attribute("synopsis.excerpt_length");if("number"==typeof(null==(o=c)?void 0:o.richExcerpts())?null==(n=c)||n.richExcerpts():s().forum.attribute("synopsis.rich_excerpts"),0!==l&&null!=p&&null!=p.contentHtml&&p.contentHtml()){var f=function(t){var e=/<p><img[^>]*src="([^"]*)"[^>]*alt="([^"]*)"[^>]*><\/p>/i,s=t.match(e),r="",o="";if(s){r=s[1];var n=(o=s[2]).split("x").map(Number),i=n[0],c=n[1];return'<div class="image-container" '+(c>i?"style=\"background-size:100% 100%; background-image: url('"+r+"?x-oss-process=image/resize,h_10,m_lfit');\"":"")+"><img "+(c>i?'style=" object-fit: contain !important;"':'style=" object-fit: cover !important;"')+' src="'+r+'" alt="'+o+'"></div><div class="content-container">'+t.replace(e,"")+"</div>"}return t}(p.contentHtml().replace(/https:\/\/(pan|baidu)\.[^\s]+/g,"进入详情查看")),d=m.trust((0,u.truncate)(f,l));if(p){if(m("div",{className:"custom-i1"}),!/<img[^>]*>/i.test(p.contentHtml())){var v=m("div",{className:"custom-excerptI"});t.add("excerptI",v,600)}var h=m("div",{className:"custom-excerpt"},d);t.add("excerptM",h,500),t.has("tags")&&t.setPriority("tags",70);var x=m("div",{className:"custom-excerpt2"});t.add("excerptMC",x,60),t.has("terminalPost")&&t.setPriority("terminalPost",50),t.has("discussion-views")&&t.setPriority("discussion-views",0)}}}}))}void 0!==x()&&(0,n.extend)(x().prototype,"viewItems",(function(e){t()})),s().initializers.has("flarum-tags")&&(f().prototype.richExcerpts=v().attribute("richExcerpts"),f().prototype.excerptLength=v().attribute("excerptLength")),t()})(),(0,n.extend)(g().prototype,"oninit",(function(){this.showSynopsisExcerpts=P()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=P()(this.user.preferences().showSynopsisExcerptsOnMobile)})),(0,n.extend)(o().prototype,"oncreate",(function(){if(s().current&&"discussion"===s().current.get("routeName")){var t=this.attrs.post.data.attributes,e=t.cslink,r=t.colink;if(e&&r){var o=this.element.querySelector(".Post-body");if(o){var n=new RegExp(r,"g");o.innerHTML=o.innerHTML.replace(n,e)}}}})),(0,n.extend)(c().prototype,"sortMap",(function(t){Object.keys(t).forEach((function(e){"latest"==e&&delete t[e],"top"==e&&delete t[e]})),t.latest="-lastPostedAt",t.top="-commentCount"}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map