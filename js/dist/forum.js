(()=>{var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var s=e.n(t);const r=flarum.core.compat["forum/components/Post"];var o=e.n(r);const a=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/states/DiscussionListState"];var c=e.n(n);const i=flarum.core.compat["forum/components/DiscussionListItem"];var p=e.n(i);const l=flarum.core.compat["common/utils/string"],u=flarum.core.compat["tags/models/Tag"];var d=e.n(u);const v=flarum.core.compat["common/Model"];var f=e.n(v);const g=flarum.core.compat["forum/components/SearchPage"];var y=e.n(g);const h=flarum.core.compat["forum/components/SettingsPage"];var x=e.n(h);const b=flarum.core.compat["common/utils/Stream"];var _=e.n(b);s().initializers.add("prippp-synopsis",(function(){!function(){function e(){(0,a.extend)(p().prototype,"infoItems",(function(e){var t,r,o,a,n=this.attrs.discussion;if(!s().session.user||s().session.user.preferences().showSynopsisExcerpts){var c,i=n.tags();i&&(c=i[i.length-1]);var p="first"===s().forum.attribute("synopsis.excerpt_type")?n.firstPost():n.lastPost(),u="number"==typeof(null==(t=c)?void 0:t.excerptLength())?null==(r=c)?void 0:r.excerptLength():s().forum.attribute("synopsis.excerpt_length");if("number"==typeof(null==(o=c)?void 0:o.richExcerpts())?null==(a=c)||a.richExcerpts():s().forum.attribute("synopsis.rich_excerpts"),0!==u&&null!=p&&null!=p.contentHtml&&p.contentHtml()){var d=p.contentHtml().replace(/\[pay\]/g,"").replace(/\[\/pay\]/g,"");d=(d=d.replace(/<blockquote style="text-align:center;padding:30px"><div><p>付费内容<\/p><\/div><\/blockquote>/g,'<p>链接：<a href="进入详情查看" rel="ugc nofollow">进入详情查看</a></p>')).replace(/<div class="pay2see_gray"><div class="pay2see_header_gray">付费内容 \[权限设置可见\]<\/div>/g,""),console.log("源文件 aaaaaa",d),d=(d=d.replace(/<div class="pay2see_green">\s*<div class="pay2see_header_green">\s*购买的内容\s*<\/div>/g,"")).replace(/<div class="pay2see_gray"><div class="pay2see_header_gray">付费内容 \[作者可见\]<\/div>/g,""),console.log("源文件 bbbbbbb：",d);var v=function(e){var t=/<img[^>]*src="([^"]*)"[^>]*>/i,s=e.match(t),r="",o="";s&&(o='<img src="'+(r=s[1])+'" alt="image">');var a=e.replace(t,"");return(r?'\n            <div class="image-container">\n                <div class="blur-background" style="\n                    background-image: url(\''+r+"?x-oss-process=image/resize,h_10,m_lfit');\n                    background-size: 100% 100%;\n                \">\n                    "+o+"\n                </div>\n            </div>\n        ":"")+'<div class="content-container">'+(a=a.replace(/<div[^>]*>|<\/div>/g,""))+"</div>"}((d=d.replace(/<\/div>/g,"")).replace(/https:\/\/(pan|baidu)\.[^\s]+/g,"进入详情查看")),f=m.trust((0,l.truncate)(v,u));if(p){if(m("div",{className:"custom-i1"}),!/<img[^>]*>/i.test(p.contentHtml())){var g=m("div",{className:"custom-excerptI"});e.add("excerptI",g,600)}var y=m("div",{className:"custom-excerpt"},f);e.add("excerptM",y,500),e.has("tags")&&e.setPriority("tags",70);var h=m("div",{className:"custom-excerpt2"});e.add("excerptMC",h,60),e.has("terminalPost")&&e.setPriority("terminalPost",50),e.has("discussion-views")&&e.setPriority("discussion-views",0)}}}}))}void 0!==y()&&(0,a.extend)(y().prototype,"viewItems",(function(t){e()})),s().initializers.has("flarum-tags")&&(d().prototype.richExcerpts=f().attribute("richExcerpts"),d().prototype.excerptLength=f().attribute("excerptLength")),e()}(),(0,a.extend)(x().prototype,"oninit",(function(){this.showSynopsisExcerpts=_()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=_()(this.user.preferences().showSynopsisExcerptsOnMobile)})),(0,a.extend)(o().prototype,"oncreate",(function(){if(s().current&&"discussion"===s().current.get("routeName")){var e=this.attrs.post.data.attributes,t=e.cslink,r=e.colink;if(t&&r){var o=this.element.querySelector(".Post-body");if(o){var a=new RegExp(r,"g");o.innerHTML=o.innerHTML.replace(a,t)}}}})),(0,a.extend)(c().prototype,"sortMap",(function(e){Object.keys(e).forEach((function(t){"latest"==t&&delete e[t],"top"==t&&delete e[t]})),e.latest="-lastPostedAt",e.top="-commentCount"}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map