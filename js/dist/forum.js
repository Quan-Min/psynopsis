(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var s=t.n(e);const o=flarum.core.compat["forum/components/Post"];var r=t.n(o);const n=flarum.core.compat["common/extend"],c=flarum.core.compat["forum/states/DiscussionListState"];var i=t.n(c);const a=flarum.core.compat["forum/components/DiscussionListItem"];var p=t.n(a);const u=flarum.core.compat["common/utils/string"],l=flarum.core.compat["tags/models/Tag"];var f=t.n(l);const d=flarum.core.compat["common/Model"];var v=t.n(d);const h=flarum.core.compat["forum/components/SearchPage"];var x=t.n(h);const y=flarum.core.compat["forum/components/SettingsPage"];var g=t.n(y);const b=flarum.core.compat["common/utils/Stream"];var P=t.n(b);s().initializers.add("prippp-synopsis",(function(){!function(){function t(){(0,n.extend)(p().prototype,"infoItems",(function(t){var e,o,r,n,c=this.attrs.discussion;if(!s().session.user||s().session.user.preferences().showSynopsisExcerpts){var i,a=c.tags();a&&(i=a[a.length-1]);var p="first"===s().forum.attribute("synopsis.excerpt_type")?c.firstPost():c.lastPost(),l="number"==typeof(null==(e=i)?void 0:e.excerptLength())?null==(o=i)?void 0:o.excerptLength():s().forum.attribute("synopsis.excerpt_length");if("number"==typeof(null==(r=i)?void 0:r.richExcerpts())?null==(n=i)||n.richExcerpts():s().forum.attribute("synopsis.rich_excerpts"),0!==l&&null!=p&&null!=p.contentHtml&&p.contentHtml()){var f,d,v,h=(d=/<p>(<img[^>]*>.*?<\/p>)/i,((v=(f=p.contentHtml().replace(/https:\/\/(pan|baidu|alipan|xuelei|115)\.[^\s]+/g,"进入详情查看")).match(d)?f.match(d)[1]:"")?'<div class="image-container">'+v+"</div>":"")+'<div class="content-container">'+f.replace(d,"")+"</div>"),x=m.trust((0,u.truncate)(h,l));if(p){if(m("div",{className:"custom-i1"}),!/<img[^>]*>/i.test(p.contentHtml())){var y=m("div",{className:"custom-excerptI"});t.add("excerptI",y,600)}var g=m("div",{className:"custom-excerpt"},x);t.add("excerptM",g,500),t.has("tags")&&t.setPriority("tags",70);var b=m("div",{className:"custom-excerpt2"});t.add("excerptMC",b,60),t.has("terminalPost")&&t.setPriority("terminalPost",50),t.has("discussion-views")&&t.setPriority("discussion-views",0)}}}}))}void 0!==x()&&(0,n.extend)(x().prototype,"viewItems",(function(e){t()})),s().initializers.has("flarum-tags")&&(f().prototype.richExcerpts=v().attribute("richExcerpts"),f().prototype.excerptLength=v().attribute("excerptLength")),t()}(),(0,n.extend)(g().prototype,"oninit",(function(){this.showSynopsisExcerpts=P()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=P()(this.user.preferences().showSynopsisExcerptsOnMobile)})),(0,n.extend)(r().prototype,"oncreate",(function(){if(s().current&&"discussion"===s().current.get("routeName")){var t=this.attrs.post.data.attributes,e=t.cslink,o=t.colink;if(e&&o){var r=this.element.querySelector(".Post-body");if(r){var n=new RegExp(o,"g");r.innerHTML=r.innerHTML.replace(n,e)}}}})),(0,n.extend)(i().prototype,"sortMap",(function(t){Object.keys(t).forEach((function(e){"latest"==e&&delete t[e],"top"==e&&delete t[e]})),t.latest="-lastPostedAt",t.top="-commentCount"}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map