(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var s=t.n(e);const o=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/components/DiscussionListItem"];var n=t.n(r);const i=flarum.core.compat["common/utils/string"],c=flarum.core.compat["tags/models/Tag"];var a=t.n(c);const p=flarum.core.compat["common/Model"];var u=t.n(p);const l=flarum.core.compat["forum/components/SearchPage"];var f=t.n(l);const d=flarum.core.compat["forum/components/SettingsPage"];var v=t.n(d);const h=flarum.core.compat["common/utils/Stream"];var x=t.n(h);s().initializers.add("prippp-synopsis",(function(){!function(){function t(){(0,o.extend)(n().prototype,"infoItems",(function(t){var e,o,r,n,c=this.attrs.discussion;if(!s().session.user||s().session.user.preferences().showSynopsisExcerpts){var a,p=c.tags();p&&(a=p[p.length-1]);var u="first"===s().forum.attribute("synopsis.excerpt_type")?c.firstPost():c.lastPost(),l="number"==typeof(null==(e=a)?void 0:e.excerptLength())?null==(o=a)?void 0:o.excerptLength():s().forum.attribute("synopsis.excerpt_length");if("number"==typeof(null==(r=a)?void 0:r.richExcerpts())?null==(n=a)||n.richExcerpts():s().forum.attribute("synopsis.rich_excerpts"),0!==l&&null!=u&&null!=u.contentHtml&&u.contentHtml()){var f,d,v,h=(d=/<p>(<img[^>]*>.*?<\/p>)/i,((v=(f=u.contentHtml().replace(/https:\/\/(pan|baidu|alipan|xuelei|115)\.[^\s]+/g,"进入详情查看")).match(d)?f.match(d)[1]:"")?'<div class="image-container">'+v+"</div>":"")+'<div class="content-container">'+f.replace(d,"")+"</div>"),x=m.trust((0,i.truncate)(h,l));if(u){if(m("div",{className:"custom-i1"}),!/<img[^>]*>/i.test(u.contentHtml())){var y=m("div",{className:"custom-excerptI"});t.add("excerptI",y,600)}var g=m("div",{className:"custom-excerpt"},x);t.add("excerptM",g,500),t.has("tags")&&t.setPriority("tags",70);var b=m("div",{className:"custom-excerpt2"});t.add("excerptMC",b,60),t.has("terminalPost")&&t.setPriority("terminalPost",50),t.has("discussion-views")&&t.setPriority("discussion-views",0)}}}}))}void 0!==f()&&(0,o.extend)(f().prototype,"viewItems",(function(e){t()})),s().initializers.has("flarum-tags")&&(a().prototype.richExcerpts=u().attribute("richExcerpts"),a().prototype.excerptLength=u().attribute("excerptLength")),t()}(),(0,o.extend)(v().prototype,"oninit",(function(){this.showSynopsisExcerpts=x()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=x()(this.user.preferences().showSynopsisExcerptsOnMobile)})),extend(Post.prototype,"oncreate",(function(){if(s().current&&"discussion"===s().current.get("routeName")){var t=this.attrs.post.data.attributes,e=t.cslink,o=t.colink;if(e&&o){var r=this.element.querySelector(".Post-body");if(r){var n=new RegExp(o,"g");r.innerHTML=r.innerHTML.replace(n,e)}}}})),extend(DiscussionListState.prototype,"sortMap",(function(t){Object.keys(t).forEach((function(e){"latest"==e&&delete t[e],"top"==e&&delete t[e]})),t.latest="-lastPostedAt",t.top="-commentCount"}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map